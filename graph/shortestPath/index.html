<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>最短路徑 - FJCU CPC 訓練網</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">FJCU CPC 訓練網</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">首頁</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">工具 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../tool/cmd/" class="dropdown-item">命令列</a>
</li>
                                    
<li>
    <a href="../../tool/codeBlocks/" class="dropdown-item">Code::Blocks</a>
</li>
                                    
<li>
    <a href="../../tool/sublimeText/" class="dropdown-item">Sublime Text</a>
</li>
                                    
<li>
    <a href="../../tool/vsCode/" class="dropdown-item">VS Code</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">語法篇 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../syntax/intro/" class="dropdown-item">基本介紹</a>
</li>
                                    
<li>
    <a href="../../syntax/type/" class="dropdown-item">基本資料型態</a>
</li>
                                    
<li>
    <a href="../../syntax/inputOutput/" class="dropdown-item">輸入輸出</a>
</li>
                                    
<li>
    <a href="../../syntax/operator/" class="dropdown-item">運算子</a>
</li>
                                    
<li>
    <a href="../../syntax/condition/" class="dropdown-item">條件判斷</a>
</li>
                                    
<li>
    <a href="../../syntax/loop/" class="dropdown-item">迴圈</a>
</li>
                                    
<li>
    <a href="../../syntax/string/" class="dropdown-item">字串</a>
</li>
                                    
<li>
    <a href="../../syntax/array/" class="dropdown-item">陣列</a>
</li>
                                    
<li>
    <a href="../../syntax/functionAndRecursive/" class="dropdown-item">函式與遞迴</a>
</li>
                                    
<li>
    <a href="../../syntax/pointer/" class="dropdown-item">指標</a>
</li>
                                    
<li>
    <a href="../../syntax/struct/" class="dropdown-item">struct</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">雜項 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../other/complexity/" class="dropdown-item">複雜度</a>
</li>
                                    
<li>
    <a href="../../other/define/" class="dropdown-item">define</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">資料結構 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../dataStructure/stl/" class="dropdown-item">STL</a>
</li>
                                    
<li>
    <a href="../../dataStructure/stack/" class="dropdown-item">堆疊</a>
</li>
                                    
<li>
    <a href="../../dataStructure/queue/" class="dropdown-item">隊列</a>
</li>
                                    
<li>
    <a href="../../dataStructure/list/" class="dropdown-item">List</a>
</li>
                                    
<li>
    <a href="../../dataStructure/heap/" class="dropdown-item">heap</a>
</li>
                                    
<li>
    <a href="../../dataStructure/bst/" class="dropdown-item">二元平衡樹</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">基礎演算法 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../algorithm/" class="dropdown-item">何謂演算法</a>
</li>
                                    
<li>
    <a href="../../algorithm/enumerate/" class="dropdown-item">枚舉</a>
</li>
                                    
<li>
    <a href="../../algorithm/binarySearch/" class="dropdown-item">二分搜</a>
</li>
                                    
<li>
    <a href="../../algorithm/divideAndConquer/" class="dropdown-item">分治</a>
</li>
                                    
<li>
    <a href="../../algorithm/greedy/" class="dropdown-item">貪心</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">圖論 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">圖論簡介</a>
</li>
                                    
<li>
    <a href="../concept/" class="dropdown-item">圖論概念</a>
</li>
                                    
<li>
    <a href="../save/" class="dropdown-item">圖的儲存</a>
</li>
                                    
<li>
    <a href="../traverse/" class="dropdown-item">圖的遍歷</a>
</li>
                                    
<li>
    <a href="../timeStamp/" class="dropdown-item">時間戳記</a>
</li>
                                    
<li>
    <a href="../lca/" class="dropdown-item">最低共同祖先</a>
</li>
                                    
<li>
    <a href="../disjointSet/" class="dropdown-item">並查集</a>
</li>
                                    
<li>
    <a href="../mst/" class="dropdown-item">最小生成樹</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">最短路徑</a>
</li>
                                    
<li>
    <a href="../euler/" class="dropdown-item">歐拉回路</a>
</li>
                                    
<li>
    <a href="../hamilton/" class="dropdown-item">哈密頓</a>
</li>
                                    
<li>
    <a href="../topology/" class="dropdown-item">拓譜排序</a>
</li>
                                    
<li>
    <a href="../connectivity/" class="dropdown-item">連通性</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">數論 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../math/primeAndFactor/" class="dropdown-item">質數和因數</a>
</li>
                                    
<li>
    <a href="../../math/mod/" class="dropdown-item">模</a>
</li>
                                    
<li>
    <a href="../../math/euler/" class="dropdown-item">歐拉定理及相關應用</a>
</li>
                                    
<li>
    <a href="../../math/chineseRemainderTheorem/" class="dropdown-item">中國剩餘定理</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../mst/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../euler/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">最短路徑</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">術語</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#floyd-warshall-algorithm" class="nav-link">Floyd-Warshall Algorithm</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">單點源最短路徑</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#bellman-ford-algorithm" class="nav-link">Bellman-Ford Algorithm</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#dijkstras-algorithm" class="nav-link">Dijkstra’s Algorithm</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">最短路徑</h1>
<h2 id="_2">術語</h2>
<ul>
<li>負邊：權重為負的邊</li>
<li>負環：權重和為負的環</li>
<li>點源：成為起點的點，分成單源頭及多源頭。</li>
<li>鬆弛：單源頭最短路徑中，對於任意兩個點 <script type="math/tex">u,v</script> ，起點 <script type="math/tex">s</script> 到它們的距離 <script type="math/tex">d_u,d_v</script> ，如果 <script type="math/tex">d_u>d_v+w_{u,v}</script> ， <script type="math/tex">w_{u,v}</script> 為邊 <script type="math/tex">(u,v)</script> 的權重，我們可以讓 <script type="math/tex">d_u</script> 更新為 <script type="math/tex">d_v+w_{u,v}</script> ，讓 <script type="math/tex">s</script> 到 <script type="math/tex">u</script> 的距離縮短，這個動作稱為 "鬆弛"。</li>
</ul>
<h2 id="floyd-warshall-algorithm">Floyd-Warshall Algorithm</h2>
<p>為多源頭最短路徑，求出所有點對的最短路徑。
Floyd-Warshall 是一種動態規劃問題，以下是他的 dp 式。</p>
<ul>
<li>狀態： <script type="math/tex">dp[k][i][j]</script> 代表，若只以點 <script type="math/tex">1 ∼ k</script> 當中繼點的話，則 <script type="math/tex">dp[k][i][j]</script> 為 <script type="math/tex">i</script> 到 <script type="math/tex">j</script> 的最短路徑長。</li>
<li>轉移： <script type="math/tex">dp[k][i][j] = min(dp[k − 1][i][k] + dp[k − 1][k][j], dp[k − 1][i][j])</script>
</li>
<li>基底：
    <script type="math/tex; mode=display">
    dp[0][i][j] = \left\{ \begin{array}{cc}w[i][j] & if\ w[i][j]\ exists\\INF & else\end{array} \right\}
    </script>
</li>
</ul>
<p>時/空間複雜度皆為 <script type="math/tex">O(V^3)</script> ，然而此 DP 是可以滾動，所以空間複雜度可降為 <script type="math/tex">O(V^2)</script>
</p>
<pre><code class="language-cpp">for (k = 0; k &lt; n; k++)
  for (i = 0; i &lt; n; i++)
    for (j = 0; j &lt; n; j++)
      w[i][j] = w[j][i] = min(w[i][j], max(w[i][k], w[k][j]));
</code></pre>
<p>執行的時候如果 <script type="math/tex">dp[i][j]\leq 0</script> ，代表存在負環，Floyd-Warshall 是可以判斷負環。</p>
<h2 id="_3">單點源最短路徑</h2>
<p>求出一個點到所有點的最短路徑，其實就是以起點為根，最短路徑是由父節點鬆弛而來的最短路徑樹。我們找最短路徑，就是一直把鬆弛，直到所有點都不能鬆弛，所有點都獲得最短路徑了。要蓋出最短路徑樹，就只要把點指向最後一次被誰鬆弛就好了。</p>
<h2 id="bellman-ford-algorithm">Bellman-Ford Algorithm</h2>
<p>為單點源最短路徑，設起點的最短路徑為 0，其他點為無限大，每次對所有邊枚舉，因為最短路徑不會經過同樣的邊第二次，所以只要執行 <script type="math/tex">V-1</script> 輪，複雜度為 <script type="math/tex">O(VE)</script> 。如果執行第 <script type="math/tex">V</script> 次時還有邊可以鬆弛，代表有負環，Bellman-Ford 也可以當成負環的判斷方法。</p>
<pre><code class="language-cpp">void bellman_ford(int s) {
  d[s] = 0;
  p[s] = s;
  for (int i = 0; i &lt; V - 1; i++) {
    for (int ss = 0; ss &lt; V; ss++) {
      for (auto tt : v[ss]) {
        if (d[ss] + w[ss][tt] &lt; d[tt]) {
          d[tt] = d[ss] + w[ss][tt];
          p[tt] = ss;
        }
      }
    }
  }
}
bool has_negative_cycle() {
  for (int i = 0; i &lt; V; i++) {
    for (int j = 0; j &lt; V; j++) {
      if (d[i] + w[i][j] &lt; d[j])
        return true;
    }
  }
  return false;
}
</code></pre>
<p>此演算法還有一個優化版本叫做 Shortest Path Faster Algorithm (SPFA)，他的做法是枚舉起點是鬆弛過的邊，以鬆弛過的點除非被重新鬆弛，否則不會更動。預期複雜度為 <script type="math/tex">O(V+E)</script> ，不過最差狀況仍為 <script type="math/tex">O(VE)</script> 。</p>
<h2 id="dijkstras-algorithm">Dijkstra’s Algorithm</h2>
<p>同樣為單點源最短路徑，他的想法和 Prim's Algorithm 類似，每次把離樹根最近的點加入最短路徑樹裡，並把所有與該點相連的邊鬆弛，已經加入的點不會在被鬆弛。使用 <code>priority_queue</code> 的複雜度為 <script type="math/tex">O((V+E)\log E)</script> ，使用費波那契堆，複雜度為 <script type="math/tex">O(E+V\log V)</script>
</p>
<pre><code class="language-cpp">struct edge {
  int s, t;
  LL d;
  edge(){};
  edge(int s, int t, LL d) : s(s), t(t), d(d) {}
};

struct heap {
  LL d;
  int p; // point
  heap(){};
  heap(LL d, int p) : d(d), p(p) {}
  bool operator&lt;(const heap &amp;b) const { return d &gt; b.d; }
};
int d[N], p[N];
vector&lt;edge&gt; edges;
vector&lt;int&gt; G[N];
bitset&lt;N&gt; vis;
void dijkstra(int ss) {
  priority_queue&lt;heap&gt; Q;
  for (int i = 0; i &lt; V; i++)
    d[i] = INF;
  d[ss] = 0;
  p[ss] = -1;
  vis.reset() : Q.push(heap(0, ss));
  heap x;
  while (!Q.empty()) {
    x = Q.top();
    Q.pop();
    int p = x.p;
    if (vis[p])
      continue;
    vis[p] = 1;
    for (int i = 0; i &lt; G[p].size(); i++) {
      edge &amp;e = edges[G[p][i]];
      if (d[e.t] &gt; d[p] + e.d) {
        d[e.t] = d[p] + e.d;
        p[e.t] = G[p][i];
        Q.push(heap(d[e.t], e.t));
      }
    }
  }
}
</code></pre>
<p>而 Dijkstra’s Algorithm 不能處理負邊，原因是一旦點加入最短路徑樹，就不會再被更新，以維持良好複雜度，負邊會破壞此規則。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
